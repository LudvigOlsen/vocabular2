---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  dpi = 92,
  fig.retina = 2,
  out.width = "100%"
)

```

# vocabular2

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- [![CRAN status](https://www.r-pkg.org/badges/version/vocabr)](https://CRAN.R-project.org/package=vocabr) -->
<!-- badges: end -->

The goal of vocabular2 is to compare vocabularies on a set of metrics. 
There's currently no clear development path for the package. It may become usable in the future, but for now it's not adviced to use the code for your projects.

## Installation

You can install the development version with:

``` r
devtools::install_github("ludvigolsen/vocabular2")
```

## Simple Example

Note: By default, negative values are set to 0 for most of the metrics (not TD-IDF and TF-IRF).

```{r message=FALSE, warning=FALSE}
library(vocabular2)
library(tm)
library(tidyverse)
library(knitr)
```

```{r}
data <- hamlet %>% 
  dplyr::group_by(character) %>% 
  dplyr::summarise(txt = paste0(lines, collapse = " "))

claudius <- data[1, "txt"][[1]]
gertrude <- data[2, "txt"][[1]]
hamlet <- data[3, "txt"][[1]]
horatio <- data[4, "txt"][[1]]
ophelia <- data[5, "txt"][[1]]

```

```{r warning=FALSE}
# Create a term-count tibble

count_terms <- function(t){
  docs <- Corpus(VectorSource(t))
  # do things like removing stopwords, lemmatization, etc.
  docs <- tm_map(docs, removeWords, stopwords("english"))
  docs <- tm_map(docs, removePunctuation, preserve_intra_word_dashes = TRUE)
  dtm <- TermDocumentMatrix(docs)
  m <- as.matrix(dtm)
  v <- sort(rowSums(m), decreasing=TRUE)
  d <- tibble::tibble(Word = names(v), Count=v)
  d
}

claudius_tc <- count_terms(claudius)
gertrude_tc <- count_terms(gertrude)
hamlet_tc <- count_terms(hamlet)
horatio_tc <- count_terms(horatio)
ophelia_tc <- count_terms(ophelia)
```


```{r}
scores <- compare_vocabs(tc_dfs = list("claudius" = claudius_tc,
                                       "gertrude" = gertrude_tc,
                                       "hamlet" = hamlet_tc,
                                       "horatio" = horatio_tc,
                                       "ophelia" = ophelia_tc))
scores
```

```{r}
get_doc_metrics(scores, "claudius") %>% 
  arrange(desc(REL_TF_NRTF)) %>% 
  head(10) %>% 
  kable()
```

```{r}
get_doc_metrics(scores, "gertrude") %>% 
  arrange(desc(REL_TF_NRTF)) %>% 
  head(10) %>% 
  kable()
```

```{r}
get_doc_metrics(scores, "hamlet") %>% 
  arrange(desc(REL_TF_NRTF)) %>% 
  head(10) %>% 
  kable()
```

```{r}
get_doc_metrics(scores, "horatio") %>% 
  arrange(desc(REL_TF_NRTF)) %>% 
  head(10) %>% 
  kable()
```

```{r}
get_doc_metrics(scores, "ophelia") %>% 
  arrange(desc(REL_TF_NRTF)) %>% 
  head(10) %>% 
  kable()
```

## Metrics

### TF-IDF and TF-IRF (Term Frequency - Inverse Rest Frequency)
These are highly correlated (>0.999).

<!--$$ tf(t,d)=\frac{f_{t,d}}{\sum_{t'}^{d}f_{t',d}} $$-->
![equation](https://latex.codecogs.com/png.latex?%5Cdpi%7B120%7D%20%5Csmall%20tf%28t%2Cd%29%3D%5Cfrac%7Bf_%7Bt%2Cd%7D%7D%7B%5Csum_%7Bt%27%7D%5E%7Bd%7Df_%7Bt%27%2Cd%7D%7D)

<!--$$ idf(t,D)=\log{\frac{|D|}{1+|\{d \in D:t \in d\}|}} $$-->
![equation](https://latex.codecogs.com/svg.latex?%5Cdpi%7B300%7D%20%5Cfn_cm%20idf%28t%2CD%29%3D%5Clog%7B%5Cfrac%7B%7CD%7C%7D%7B1&plus;%7C%7Bd%20%5Cin%20D%3At%20%5Cin%20d%7D%7C%7D%7D)

$$ irf(t,d,D)=\log{\frac{|D|-1}{1+|\{d \in D:t \in d \land d' \not = d \}|}} $$
$$ tfidf(t,d,D) = tf(t,d) \cdot idf(t,D) $$
$$ tfirf(t,d,D) = tf(t,d) \cdot irf(t,d,D) $$

### TF-RTF (Term Frequency - Rest Term Frequency)
TF-RTF is positive when the term frequency is higher in the current document than the sum of the term frequencies in the rest of the corpus.

$$ rtf(t,d,D) = \sum_{d' \not = d}^{D}tf(t,d') $$
$$ tfrtf(t,d,D) = tf(t,d)-rtf(t,d,D) $$

### TF-NRTF (Term Frequency - Normalized Rest Term Frequency)
As our selected TF function ensures that frequencies add up to 1 document-wise, the NRTF (Normalized Rest Term Frequency) is simply the average term frequency in the other documents, instead of the sum as in RTF.

$$ nrtf(t,d,D) = \frac{rtf(t,d,D)}{|D|-1} $$
$$ tfnrtf(t,d,D) = tf(t,d)-nrtf(t,d,D) $$

### TF-MRTF (Term Frequency - Maximum Rest Term Frequency)
Instead of the normalized/average rest term frequency, we instead use the maximum rest term frequency.

$$ Mrtf(t,d,D) = \frac{\max{\{tf(t,d'):d' \in D \land d' \not = d\}}}{|D|-1} $$

$$ tfMrtf(t,d,D) = tf(t,d)-Mrtf(t,d,D) $$

### Rel TF-NRTF (Relative Term Frequency - Normalized Rest Term Frequency)

$$ \epsilon(t,d,D) = \frac{1}{\sum_{d' \not = d}^{D}f_{t,d'}} $$

$$ rel\_tfnrtf(t,d,D) = tf(t,d)^{\beta}\frac{tfnrtf(t,d,D)}{\log(1 + nrtf(t,d,D) + \epsilon(t,d,D))} $$
Epsilon (ε) is added to avoid zero-division. It is calculated to resemble +1 smoothing in the rest population. 

The beta (β) exponentiator allows us to control the influence of the term frequency. By setting it to 0, we get the relative difference (log scaled).

### Rel TF-MRTF (Relative Term Frequency - Maximum Rest Term Frequency)

$$ rel\_tfMrtf(t,d,D) = tf(t,d)^{\beta}\frac{tfMrtf(t,d,D)}{\log(1 + Mrtf(t,d,D) + \epsilon(t,d,D))} $$
